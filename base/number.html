<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>number</title>
</head>
<body>
<script>
    onload = () => {
        // ceil 向上取整 返回不小于当前值的最大整数
        // floor 向下取整 返回不大于当前值的最大整数
        write(Math.ceil(1.1));
        write(Math.floor(1.9));
        // round 四舍五入 Math.floor(x + 0.5) 将原来数字加上0.5后向下取整
        write(Math.round(.5));
        write(Math.round(-.5));

        // toFixed采用银行家舍入规则
        // 四舍六入五留双 => 四舍六入五考虑 五后非零就进一 五后为零看奇偶 五前为偶应舍去 五前为奇要进一

        write(.0051.toFixed(2), '进一为0.01'); // 0.01
        write();

        // chrome firefox safari opera结果 五前为奇皆未进1 反而ie11可以进1
        // 可能是计算机二进制环境浮点数计算精度缺失
        write(.005.toFixed(2), '舍去为0.01'); // 0.01
        write(.015.toFixed(2), '进一为0.02'); // 0.01

        write(toFixed(.005, 2), '舍去为0.01'); // 0.01
        write(toFixed(.015, 2), '进一为0.02'); // 0.02

        write();
        write('补零测试');

        write(.1.toFixed(2)); // 0.10
        write(toFixed(.1, 2)); // 0.10

        write(-.1.toFixed(2)); // -0.1
        write(toFixed(-.1, 2)); // 0.10
    }

    const write = function () {
        document.write(Array.prototype.slice.call(arguments).join('&nbsp') + '<br>');
    }

    function toFixed(value, repeat) {
        if (isEmpty(value)) throw '无法处理空值';
        let count = Math.pow(10, repeat);
        // parseFloat('-.1') => -0.1
        return zeroFill(Math.round(parseFloat(value) * count) / count, repeat);
    }

    function zeroFill(result, repeat) {
        if (isEmpty(repeat) || repeat === 0) return result;
        result = result.toString();
        if (result.indexOf('0') !== 0 && result.indexOf('-0') !== 0) repeat--;
        let dot = result.indexOf('.');
        // 判定如果是整数 增加小数点再补0
        if (dot === -1) {
            result += '.';
            dot = result.length;
        }
        while (result.length <= dot + repeat) {
            result += '0';
        }
        return result;
    }

    function isEmpty(value) {
        return (typeof (value) === 'undefined' || value === null)
            || (typeof (value) === 'string' && value.trim().length === 0);
    }
</script>
</body>
</html>
