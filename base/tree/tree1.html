<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>树形多选</title>
    <style>
        #tree-content, #tree-content ul {
            list-style: none;
        }

        /* 展开 */
        .tree-open {
            margin-left: -12px;
            border: 6px solid transparent;
            display: inline-block;
            vertical-align: text-bottom;
            border-top-color: black;
        }

        /* 关闭 */
        .tree-close {
            margin-left: -12px;
            border: 6px solid transparent;
            display: inline-block;
            border-left-color: black;
            vertical-align: middle;
        }

        input, button {
            outline: none;
        }

        input[type=checkbox] {
            /* 去除浏览器默认样式 */
            -webkit-appearance: none;
            border: none;
            background-color: gold;
            border-radius: 4px;
        }

        /* 选中前 */
        input[type=checkbox]::after {
            content: 'L';
            display: block;
            width: 20px;
            height: 20px;
            color: transparent;
            box-sizing: border-box;
            text-align: center;
            font-size: 16px;
            line-height: 14px;
            padding: 2px 0 0 2px;
            transform: matrix(-0.766044, -0.642788, -0.642788, 0.766044, 0, 0);
            -webkit-transform: matrix(-0.766044, -0.642788, -0.642788, 0.766044, 0, 0);
        }

        /* checkbox选中后 */
        input[type=checkbox]:checked::after {
            color: white;
        }

        /* checkbox选中后 */
        input[type=checkbox]:checked::after.miss {
            color: green;
        }
    </style>
</head>
<body>
<ul id="tree-content"></ul>
<script>
    // 结构
    let data = {
        '0': {
            '0-0': null,
            '0-1': {
                '0-1-0': null,
                '0-1-1': null,
                '0-1-2': null
            },
            '0-2': null
        },
        '1': {
            '1-0': null,
            '1-1': null
        },
        '2': null
    };

    // 生成树形选择框
    function tree(data, content) {
        for (let attr in data) {
            let li = document.createElement('li');
            if (!data[attr])
                li.innerHTML = '<input type="checkbox">' + attr;
            else {
                li.innerHTML = '<span>' +
                    '<span class="tree-open" onclick="treeOpen(this)"></span>' +
                    '<input type="checkbox" onclick="treeCheck(this)">' + attr + '</span>';
                let ul = document.createElement('ul');
                li.appendChild(ul);
                tree(data[attr], ul);
            }
            content.appendChild(li);
        }
    }

    // 处理展开和收起
    function treeOpen(that) {
        let next = that.parentNode.nextElementSibling;
        if (next.style.display === 'none') {
            next.style.display = 'block';
            that.className = 'tree-open';
        } else {
            next.style.display = 'none';
            that.className = 'tree-close';
        }
    }

    // 处理全选或全不选
    function treeCheck(that) {
        // 子节点的ul
        let childrenUl = that.parentNode.nextElementSibling;
        let list = childrenUl.querySelectorAll('input');
        if (that.checked) {
            for (let i = 0; i < list.length; i++) {
                list[i].checked = true;
            }

            // // 兄弟节点的ul
            // let brotherUl =that.parentNode.parentNode;
            // // 父元素checkbox的上级元素
            // let span = that.parentNode.parentNode.previousElementSibling;
            //
            // if (span) {
            //     // 父级选择框
            //     let parentChecked = span.children[0].checked;
            //     let parentCheckedFlag= true;
            //     for (let j=0;j<brotherUl.length;j++) {
            //         if (!brotherUl[j].children[0].children[1].checked)
            //             parentCheckedFlag = false;
            //     }
            //     parentChecked = parentCheckedFlag;
            // }
        } else {
            for (let i = 0; i < list.length; i++) {
                list[i].checked = false;
            }
        }
    }

    const treeContainer = document.getElementById('tree-content');
    tree(data, treeContainer);
</script>
</body>
</html>
